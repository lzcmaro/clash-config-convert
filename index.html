<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Clash 懒人配置生成器</title>
<style>
  body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;max-width:800px;margin:40px auto;padding:0 16px;}
  label{display:block;font-size:15px;margin-top:14px;}
  input[type="text"], input[type="url"]{width:100%;padding:8px 10px;font-size:15px;box-sizing:border-box;}
  button{margin-top:18px;padding:8px 14px;font-size:15px;cursor:pointer;}
  pre{background:#f5f5f5;padding:12px;border-radius:6px;margin-top:20px;white-space:pre-wrap;word-break:break-word;max-height:500px;overflow:auto;}
</style>
</head>
<body>

<h2>Clash 懒人配置</h2>

<label>订阅名称</label>
<input id="subName" type="text" placeholder="例如：订阅一 / MySub"/>

<label>订阅链接</label>
<input id="subUrl" type="url" placeholder="https://xxx.yyyy/your/sub"/>

<button id="btnGenerate">生成并下载 YAML</button>
<button id="btnPreview">仅预览</button>

<pre id="result">结果会显示在这里</pre>

<script>
const TEMPLATE_FILE = "template.yaml";  // 请确保根目录下有 template.yaml

async function loadTemplate() {
  const res = await fetch(TEMPLATE_FILE + '?_=' + Date.now());
  if (!res.ok) throw new Error("读取 template.yaml 失败");
  return res.text();
}

function replaceTemplate(template, name, url) {
  return template
    .split("{{SUB_NAME}}").join(name)
    .split("{{SUB_URL}}").join(url);
}

async function generate(download = false) {
  const name = document.getElementById("subName").value.trim();
  const url = document.getElementById("subUrl").value.trim();
  const resultEl = document.getElementById("result");

  if (!name || !url) {
    alert("请填写订阅名称与订阅链接");
    return;
  }

  try {
    const template = await loadTemplate();
    const finalYaml = replaceTemplate(template, name, url);

    resultEl.textContent = finalYaml;

    if (download) {
      const blob = new Blob([finalYaml], { type: "text/yaml" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "config.yaml";
      a.click();
      URL.revokeObjectURL(a.href);
    }

  } catch (e) {
    alert("生成失败：" + e.message);
  }
}

document.getElementById("btnGenerate").addEventListener("click", () => generate(true));
document.getElementById("btnPreview").addEventListener("click", () => generate(false));

// 输入框按 Enter 直接生成
document.querySelectorAll("input").forEach(el => {
  el.addEventListener("keydown", e => {
    if (e.key === "Enter") generate(true);
  });
});
</script>

</body>
</html>
