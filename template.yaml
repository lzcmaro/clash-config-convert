# 本配置基于懒人配置（https://gist.github.com/liuran001/5ca84f7def53c70b554d3f765ff86a33）修改


# 延迟检测 URL
p: &p
  type: http
  # 自动更新订阅时间，单位为秒
  interval: 86400
  # 订阅节点可用性检查
  health-check:
    enable: true
    url: https://cp.cloudflare.com
    # 节点连通性检测时间，单位为秒
    interval: 1800
    # 节点超时延迟，单位为毫秒
    timeout: 2000
    # 节点自动切换差值，单位为毫秒
    tolerance: 300

# 基础配置
# --------------------------------------------------
# 如果你是小白，那么你只需要修改分割线以内的内容
# 其他部分保持不动即可

# 也可以把分割线以内的内容粘贴到您使用代理工具的「覆写」功能，然后在覆写中进行修改
# 使用覆写时可以直接将此配置文件作为订阅链接进行订阅
# https://gist.githubusercontent.com/liuran001/5ca84f7def53c70b554d3f765ff86a33/raw/config.yaml

# 如果你需要使用大于两个机场，在下方 `use` 处添加 `订阅三` （名字可以自己取），然后在 `proxy-providers` 照例添加订阅链接即可
# 反之，如果你只需要使用一个，那么将 `订阅二` 前添加 `#` 进行注释即可

# 订阅名，记得修改成自己的
# 添删订阅在这里和下方订阅链接依葫芦画瓢就行
use: &use
  type: select
  use: 
    - {{SUB_NAME}}
    # - 本地配置

# 订阅链接
# 对于订阅来说，path 为选填项，但建议启用
# 本地配置可以只填 path
proxy-providers:
  {{SUB_NAME}}:
    <<: *p
    # path: ./proxy_provider/订阅一.yaml
    url: "{{SUB_URL}}"
    # 如需要为该订阅组节点添加前缀，取消下面两行注释
    # override:
      # additional-prefix: "[订阅一]"

  # 本地配置:
    # <<: *p
    # path: ./proxy_provider/本地配置.yaml
    # 如需要为该订阅组节点添加前缀，取消下面两行注释
    # override:
      # additional-prefix: "[本地配置]"

# 小白请不要继续随意修改以下设置
# 若需修改请参阅文档 https://wiki.metacubex.one
# --------------------------------------------------

# 规则订阅
rule-providers:
  # 秋风广告拦截规则
  AWAvenue-Ads:
    type: http
    # domain 纯域名格式 | classical 经典型模式，包含 DOMAIN-SUFFIX 等，主要看该规则集返回的数据格式
    behavior: domain
    format: yaml
    # path可为空(仅限clash.meta 1.15.0以上版本)
    path: ./rule_provider/AWAvenue-Ads.yaml
    url: "https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash.yaml"
    # 更新周期：86400 秒（24小时）
    interval: 86400

mode: rule
# ipv6 支持
ipv6: true
log-level: info
# 允许局域网连接
allow-lan: true
# socks5/http 端口
mixed-port: 7890
# Meta 内核特性 https://wiki.metacubex.one/config/general
# 统一延迟
# 更换延迟计算方式,去除握手等额外延迟
unified-delay: true
# TCP 并发
# 同时对所有ip进行连接，返回延迟最低的地址
tcp-concurrent: true
# 外部控制端口
external-controller: :9090

geodata-mode: true

# Geo 数据库下载地址
# 源地址 https://github.com/MetaCubeX/meta-rules-dat
# 可以更换镜像站但不要更换其他数据库，可能导致无法启动
geox-url:
  geoip: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"
  asn: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/GeoLite2-ASN.mmdb"

# 进程匹配模式
# 路由器上请设置为 off
# always 开启，强制匹配所有进程
# strict 默认，由 Clash 判断是否开启
# off 不匹配进程，推荐在路由器上使用此模式
find-process-mode: strict

# 缓解移动设备耗电问题
# https://github.com/vernesong/OpenClash/issues/2614
keep-alive-interval: 1800

# 全局客户端指纹
global-client-fingerprint: random # 随机指纹

# 缓存
profile:
  store-selected: true
  store-fake-ip: true

# tun 模式
tun:
  enable: false  # enable 'true'
  stack: system  # or 'gvisor'
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-detect-interface: true

# dns 设置
dns:
  enable: true
  ipv6: false
  use-hosts: true
  respect-rules: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - 'geosite:cn'
    - '+.local'

  # 当 nameserver 或 nameserver-policy 没有匹配到特定域名时，或者配置中没有 fallback 时，会使用 default-nameserver 来解析
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - 114.114.114.114

  # 默认使用国内 DNS（加速国内访问）
  nameserver:
    - 'https://dns.alidns.com/dns-query'
    - 'https://doh.pub/dns-query'

  # 回退 DNS（当主上游失败时使用国际可用 DoH/DoT）
  fallback:
    - 'tls://1.1.1.1:853'
    - 'tls://8.8.8.8:853'
    - 'https://doh.pub/dns-query'

  # 特殊域名走专用解析策略
  nameserver-policy:
    'geosite:cn':  # 国内网站优先国内 DNS
      - 'https://dns.alidns.com/dns-query'
      - 'https://doh.pub/dns-query'
    'geosite:gfw':  # 被墙网站走国际 DNS
      - 'tls://dns.google'
      - 'tls://cloudflare-dns.com'
    '+.google.com':
      - 'tls://dns.google'
    '+.facebook.com':
      - 'tls://dns.google'
    '+.youtube.com':
      - 'tls://dns.google'

  # 当 DNS 请求通过代理链发出时使用的上游
  proxy-server-nameserver:
    - 'tls://dns.google'
    - 'https://doh.pub/dns-query'

# 多入站端口设置
# listeners:
#   - name: hk
#     type: mixed
#     port: 12991
#     proxy: 香港

#   - name: tw
#     type: mixed
#     port: 12992
#     proxy: 台湾

#   - name: sg
#     type: mixed
#     port: 12993
#     proxy: 新加坡

proxies:
  # - name: "WARP"
  #   type: wireguard
  #   server: engage.cloudflareclient.com
  #   port: 2408
  #   ip: "172.16.0.2/32"
  #   ipv6: "2606::1/128"        # 自行替换
  #   private-key: "private-key" # 自行替换
  #   public-key: "public-key"   # 自行替换
  #   udp: true
  #   reserved: "abba"           # 自行替换
  #   mtu: 1280
  #   dialer-proxy: "WARP前置"
  #   remote-dns-resolve: true
  #   dns:
  #     - https://dns.cloudflare.com/dns-query

proxy-groups:
  - name: Proxies
    icon: https://raw.githubusercontent.com/NB921/picture/refs/heads/main/clasha.png
    proxies:
      - 自动选择
      - 故障转移
    <<: *use
  
  - name: YouTube
    icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/refs/heads/master/Social_Media/YouTube.png
    proxies:
      - Proxies
    <<: *use

  - name: Netflix
    hidden: true
    icon: https://raw.githubusercontent.com/NB921/picture/refs/heads/main/Netflix.png
    proxies:
      - Proxies
    <<: *use

  - name: Telegram
    icon: https://raw.githubusercontent.com/NB921/picture/refs/heads/main/Telegram.png
    proxies:
      - Proxies
    <<: *use

  - name: Google
    icon: https://raw.githubusercontent.com/NB921/picture/refs/heads/main/Google.png
    proxies:
      - Proxies
    <<: *use

  - name: Microsoft
    icon: https://raw.githubusercontent.com/NB921/picture/refs/heads/main/microsoft.png
    proxies:
      - DIRECT
      - Proxies
    <<: *use

  - name: OpenAI
    icon: https://raw.githubusercontent.com/NB921/picture/refs/heads/main/chatgpt.png
    proxies:
      - Proxies
    <<: *use

  - name: Apple
    icon: https://raw.githubusercontent.com/NB921/picture/refs/heads/main/Apple.png
    proxies:
      - DIRECT
      - Proxies
    <<: *use

  - name: Binance
    icon: https://raw.githubusercontent.com/NB921/picture/refs/heads/main/binance.png
    proxies:
      - DIRECT
      - Proxies
    <<: *use

  - name: Github
    icon: https://raw.githubusercontent.com/NB921/picture/refs/heads/main/Openhub.png
    proxies:
      - Proxies
    <<: *use

  - name: Final
    type: select
    icon: https://raw.githubusercontent.com/NB921/picture/refs/heads/main/Golbal.png
    proxies:
      - Proxies
      - DIRECT
    # Final组是用来兜底的，不需要注入订阅节点，默认指向Proxies组

  - name: 广告
    type: select
    proxies:
      - REJECT
      - DIRECT
      - Proxies
    icon: https://raw.githubusercontent.com/Semporia/Hand-Painted-icon/refs/heads/master/Universal/Reject.png
    # 广告组不需要注入订阅节点

  - name: 自动选择
    <<: *use
    type: url-test
    url: 'http://www.gstatic.com/generate_204'
    interval: 600
    timeout: 3000
    tolerance: 50
    # 懒惰开关，启用后，代表该策略组被使用时才会去测速
    lazy: true

  - name: 故障转移
    <<: *use
    type: fallback
    url: 'http://www.gstatic.com/generate_204'
    interval: 600

rules:
  - GEOIP,private,DIRECT,no-resolve
  - IP-CIDR,1.1.1.1/32,Final,no-resolve
  - IP-CIDR,8.8.8.8/32,Final,no-resolve
  # 广告拦截
  - RULE-SET,AWAvenue-Ads,广告
  # 代理组分流
  - GEOSITE,apple,Apple
  - GEOSITE,apple-cn,Apple
  - GEOSITE,github,Github
  - GEOSITE,youtube,YouTube
  - GEOSITE,telegram,Telegram
  - GEOSITE,microsoft,Microsoft
  - GEOSITE,openai,OpenAI
  - GEOSITE,binance,Binance
  - GEOSITE,google,Google
  - GEOSITE,google-cn,Google # Google CN 不走代理会导致香港等地区节点 Play Store 异常
  - GEOIP,google,Google
  - GEOIP,telegram,Telegram
  # 本地和国内域名
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,17.0.0.0/8,DIRECT
  - IP-CIDR,100.64.0.0/10,DIRECT
  - IP-CIDR,224.0.0.0/4,DIRECT
  - IP-CIDR6,::1/128,DIRECT,no-resolve
  - IP-CIDR6,fc00::/7,DIRECT,no-resolve
  - IP-CIDR6,fe80::/10,DIRECT,no-resolve
  - IP-CIDR6,fd00::/8,DIRECT,no-resolve
  - DOMAIN-SUFFIX,local,DIRECT
  - DOMAIN-SUFFIX,cn,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,Final
